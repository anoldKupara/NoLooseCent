@model NoLooseCent.Reports.MonthlyStatementViewModel
@{
    ViewData["Title"] = "Financial Statement";
}

<div class="container-fluid stay-interview-details">
    <div class="header-section text-center mb-5">
        <h1 class="display-5 fw-bold text-primary">Monthly Financial Statement</h1>
        <p class="lead text-muted">Review income and expense transactions for the selected month</p>
        <hr class="border-primary border-2 opacity-50 w-50 mx-auto">
    </div>

    <!-- Filter Card -->
    <div class="card shadow-lg rounded-4 mb-5">
        <div class="custom-gradient-header text-white py-3 px-4 rounded-top">
            <h5 class="mb-0"><i class="fas fa-filter me-2"></i> Filter Transactions</h5>
        </div>
        <div class="card-body">
            <form asp-action="FinancialStatement" method="get" class="row g-3 align-items-end">
                <div class="col-md-4">
                    <label class="form-label text-muted fw-semibold">Currency</label>
                    <select name="group" class="form-select rounded-pill">
                        <option value="">All Currencies</option>
                        @foreach (var item in ViewBag.CurrencyList)
                        {
                            <option value="@item.Value" selected="@(item.Selected)">@item.Text</option>
                        }
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label text-muted fw-semibold">Month</label>
                    <select name="month" class="form-select rounded-pill">
                        @foreach (var item in ViewBag.MonthList)
                        {
                            <option value="@item.Value" selected="@(item.Selected)">@item.Text</option>
                        }
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label text-muted fw-semibold">Year</label>
                    <input name="year" type="number" class="form-control rounded-pill" value="@ViewBag.SelectedYear" min="2025" max="2099" />
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary w-100 rounded-pill">
                        <i class="fas fa-search me-1"></i>Generate
                    </button>
                </div>
            </form>
        </div>
    </div>

    @if (Model is null || !Model.Entries.Any())
    {
        <div class="alert alert-info text-center py-4">
            <i class="fas fa-info-circle me-2"></i>No transactions found for the selected period.
        </div>
    }
    else
    {
        <!-- Summary Cards -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="card shadow-sm border-0 h-100">
                    <div class="card-body d-flex align-items-center gap-3">
                        <div class="bg-light-primary rounded-circle p-3">
                            <i class="fas fa-calendar-alt text-primary fs-4"></i>
                        </div>
                        <div>
                            <p class="mb-0 text-muted small">Period</p>
                            <h5 class="mb-0">@Model.MonthName @Model.Year</h5>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card shadow-sm border-0 h-100">
                    <div class="card-body d-flex align-items-center gap-3">
                        <div class="bg-light-primary rounded-circle p-3">
                            <i class="fas fa-coins text-primary fs-4"></i>
                        </div>
                        <div>
                            <p class="mb-0 text-muted small">Currency</p>
                            <h5 class="mb-0">@Model.CurrencyCode</h5>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card shadow-sm border-0 h-100">
                    <div class="card-body d-flex align-items-center gap-3">
                        <div class="bg-light-primary rounded-circle p-3">
                            <i class="fas fa-wallet text-primary fs-4"></i>
                        </div>
                        <div>
                            <p class="mb-0 text-muted small">Closing Balance</p>
                            <h5 class="mb-0">@Model.ClosingBalance.ToString("N2")</h5>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Transactions Table -->
        <div class="card shadow-lg rounded-4">
            <div class="custom-gradient-header text-white py-3 px-4 rounded-top d-flex justify-content-between align-items-center">
                <h5 class="mb-0"><i class="fas fa-list me-2"></i>Transaction Details</h5>
                <div>
                    <button id="exportPdfBtn" class="btn btn-sm btn-light me-2">
                        <i class="fas fa-file-pdf me-1"></i> PDF
                    </button>
                    <button id="exportExcelBtn" class="btn btn-sm btn-light me-2">
                        <i class="fas fa-file-excel me-1"></i> Excel
                    </button>
                    <button id="printBtn" class="btn btn-sm btn-light">
                        <i class="fas fa-print me-1"></i> Print
                    </button>
                </div>
            </div>
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="bg-light">
                        <tr>
                            <th class="text-muted">Date</th>
                            <th class="text-muted">Description</th>
                            <th class="text-end text-muted">Deposits</th>
                            <th class="text-end text-muted">Withdrawals</th>
                            <th class="text-end text-muted">Balance</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="bg-light">
                            <td colspan="4" class="fw-semibold">Opening Balance</td>
                            <td class="text-end fw-bold">@Model.OpeningBalance.ToString("N2")</td>
                        </tr>
                        @foreach (var row in Model.Entries)
                        {
                            <tr>
                                <td>@row.Date.ToString("dd MMM yyyy")</td>
                                <td>@row.Description</td>
                                <td class="text-end text-success">@(row.Deposit.HasValue ? row.Deposit.Value.ToString("N2") : "-")</td>
                                <td class="text-end text-danger">@(row.Withdrawal.HasValue ? row.Withdrawal.Value.ToString("N2") : "-")</td>
                                <td class="text-end fw-semibold">@row.Balance.ToString("N2")</td>
                            </tr>
                        }
                        <tr class="bg-light">
                            <td colspan="4" class="fw-semibold">Closing Balance</td>
                            <td class="text-end fw-bold">@Model.ClosingBalance.ToString("N2")</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    }
</div>

@section Styles {
    <style>
        .custom-gradient-header {
            background: linear-gradient(to right, #0d6efd, #3b82f6);
            font-weight: 600;
        }
        .bg-light-primary {
            background-color: rgba(13, 110, 253, 0.1);
        }
    </style>
}
