@model IEnumerable<NoLooseCent.Models.Expense>
@{
    ViewData["Title"] = "Expense Records";

    var totalExpensesUSD = Model.Where(e => e.Currency != null && !e.Currency.Code.Contains("ZWL"))
                                .Sum(e => e.Amount);
    var totalExpensesZWL = Model.Where(e => e.Currency != null && e.Currency.Code.Contains("ZWL"))
                                .Sum(e => e.Amount);
}

<div class="container-fluid stay-interview-details">
    <!-- ░░ Header ░░ -->
    <div class="header-section text-center mb-5">
        <h1 class="display-4 text-primary fw-bold">Expense Records</h1>
        <p class="lead text-muted">Tracking your financial outflows across all currencies</p>
        <hr class="border-primary border-2 opacity-50 w-50 mx-auto">
        <a asp-action="Create" class="btn btn-primary btn-lg mt-3 shadow-sm">
            <i class="fas fa-plus me-2"></i> Add Expense
        </a>
    </div>

    <!-- ░░ Summary cards ░░ -->
    <div class="row mb-4">
        <div class="col-md-6 mb-3 mb-md-0">
            <div class="card shadow-sm text-center rounded-4">
                <div class="card-body">
                    <h5 class="card-title text-muted">Total Expenses (USD)</h5>
                    <p class="display-6 text-success fw-bold">@totalExpensesUSD.ToString("C")</p>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card shadow-sm text-center rounded-4">
                <div class="card-body">
                    <h5 class="card-title text-muted">Total Expenses (ZWL)</h5>
                    <p class="display-6 text-warning fw-bold">@totalExpensesZWL.ToString("C")</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ░░ Table card ░░ -->
    <div class="card shadow-lg rounded-4 overflow-hidden">
        <!-- Gradient header -->
        <div class="custom-gradient-header text-white py-3 px-4">
            <h2 class="h5 mb-0"><i class="fas fa-list me-2"></i>Expense List</h2>
        </div>

        <div class="card-body pt-4">
            @if (!Model.Any())
            {
                <div class="p-5 text-center text-muted">
                    <h4>No expenses recorded yet.</h4>
                    <p>Click “Add Expense” to begin tracking.</p>
                </div>
            }
            else
            {
                <div class="table-responsive">
                    <table id="expenseTable" class="table table-striped table-hover align-middle w-100">
                        <thead class="table-light shadow-sm">
                            <tr class="align-middle">
                                <th>Amount</th>
                                <th>Purpose</th>
                                <th>Date</th>
                                <th>Currency</th>
                                <th class="text-end">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="table-group-divider">
                            @foreach (var item in Model)
                            {
                                <tr>
                                    <td class="fw-bold text-primary">@item.Amount</td>
                                    <td>@item.Purpose</td>
                                    <td>@item.DateSpent.ToString("dd MMM yyyy")</td>
                                    <td>
                                        <span class="badge bg-secondary px-3 py-2 rounded-pill">@item.Currency?.Name</span>
                                    </td>
                                    <td class="text-end">
                                        <a asp-action="Edit" asp-route-id="@item.Id" class="btn btn-sm btn-outline-secondary me-1 rounded-pill">
                                            <i class="fas fa-edit"></i>
                                        </a>
                                        <a asp-action="Details" asp-route-id="@item.Id" class="btn btn-sm btn-outline-primary me-1 rounded-pill">
                                            <i class="fas fa-info-circle"></i>
                                        </a>
                                        <a asp-action="Delete" asp-route-id="@item.Id" class="btn btn-sm btn-outline-danger rounded-pill">
                                            <i class="fas fa-trash-alt"></i>
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>
    </div>
</div>

@section Styles {
    <!-- DataTables Bootstrap-5 -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" />

    <style>
        /* Gradient header */
        .custom-gradient-header {
            background: linear-gradient(to right, #4f75f2 0%, #aac8ff 100%);
            border-top-left-radius: 1rem;
            border-top-right-radius: 1rem;
            font-weight: 600;
            letter-spacing: 0.3px;
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.1);
        }

        /* Google-style search box */
        table.dataTable input[type="search"] {
            border-radius: 1rem !important;
            padding: 0.5rem 1rem !important;
            border: 1px solid #ced4da;
            width: 220px;
            background-color: #fff;
            transition: all 0.2s ease-in-out;
        }

        table.dataTable thead th {
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
        }

        .dataTables_wrapper .dataTables_filter {
            padding-right: 1rem;
        }

        /* ─── Pagination Pill Style ─── */
        .dataTables_wrapper .dataTables_paginate {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 2rem;
        }

            .dataTables_wrapper .dataTables_paginate .paginate_button {
                border: none !important;
                background: #f3f4f6 !important; /* grey pill */
                color: #4b5563 !important; /* slate-600 */
                padding: 0.65rem 1.1rem !important;
                border-radius: 0.75rem !important; /* rounded */
                font-weight: 500;
                box-shadow: 0 2px 4px rgba(0,0,0,0.05);
                transition: all .18s ease-in-out;
                min-width: 44px;
            }

        .dataTables_wrapper .paginate_button:hover:not(.current):not(.disabled) {
            background: #e5e7eb !important; /* lighter grey on hover */
            color: #374151 !important; /* darker text */
        }

        .dataTables_wrapper .paginate_button.current {
            background: #6366f1 !important; /* indigo (like screenshot) */
            color: #ffffff !important;
            box-shadow: 0 4px 10px rgba(99,102,241,.35);
            cursor: default !important;
        }

        .dataTables_wrapper .paginate_button.disabled {
            opacity: 0.45 !important;
            cursor: not-allowed !important;
        }
    </style>
}

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>

    <script>
        $(function () {
            $('#expenseTable').DataTable({
                pageLength: 10,
                lengthChange: false,
                ordering: true,
                order: [[2, 'desc']],
                language: {
                    search: "_INPUT_",
                    searchPlaceholder: "Search expenses...",
                    paginate: {
                        previous: '«',
                        next: '»'
                    }
                }
            });
        });
    </script>
}